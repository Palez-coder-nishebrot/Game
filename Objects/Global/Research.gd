extends Node

const military_technologies: Array = [
	"Управление армией",
	"Техника",
	"Тяжелое вооружение",
	"Легкое вооружение",
	"Флот",
]

var max_levels: Dictionary = {
	"Фабричное производство":     6,
	"Фермерское производство":    5,
	"Добыча":                     5,
	"Инфраструктура и снабжение": 5,
	
	"Управление армией":          5,
	"Техника":                    6,
	"Тяжелое вооружение":         6,
	"Легкое вооружение":          5,
	"Флот":                       5,
}


var research: Dictionary = {
	"Фабричное производство":   "factory_production",
	"Фермерское производство":  "farm_production",
	"Добыча":                   "resourses_production",
	"Инфраструктура и снабжение":"railways",
	
	"Управление армией":        "ruling_of_army",
	"Техника":                  "armored_vehicles",
	"Тяжелое вооружение":       "heavy_weapon",
	"Легкое вооружение":        "light_weapon",
	"Флот":                     "fleet",
}


const fleet: Dictionary = {
	"Новые Дредноуты":       {
		"!Дредноут": 0,
	},
	"Броненосцы":            {
		"!Броненосец":      0,
		"*Подводная лодка": 1,
		"*Рейдер":          1,
		
	},
	"Моторные лодки":        {
		">Подводная лодка": 1,
		">Рейдер":          1,
	},
	"Тактика морской пехоты":{
		">Дредноут":        1,
		">Броненосец":      1,
		">Подводная лодка": 1,
		">Рейдер":          1,
	},
	"Ударные корабли":       {
		"!Крейсер смерти":    0,
		"!Броненосец смерти": 0,
		"*Рейдер":            2,
		"*Подводная лодка":   1,
	},
}


const ruling_of_army: Dictionary = {
	"Маневренная война":    {
		">Кавалерия": 1,
		"/Групповая тактика": 0,
		"/Полевые комиссары": 0,

	},
	"Позиционная война":    {
		"*Фронтовики":     2,
		"*Кавалерия":  2,
		"*Артиллерия": 2,
		"/Система траншей":          0,
		"/Снабжение армии в окопах": 0,
	},
	"Траншейная оборона":{
		">Фронтовики":             1,
		">Артиллерия":         1,
		"/Газовые атаки":      0,
		"/Массированный штурм":0,
	},
	"Штурмовые отряды": {
		"!Гренадеры": 1,
		">Фронтовики":      1,
		">Танки":       1,
		">Бронемашины": 1,
		"/Создание штурмовых отрядов": 0,
		"/Точечная бомбардировка":     0,
		
	},
	"Упор на мобильную армию":      {
		">Танки":       1,
		">Бронемашины": 1,
		"/Подготовка тыловиков": 1,
		"/Моторизация пехоты":   1,
	},
}


const armored_vehicles: Dictionary = {
	"Легкая бронетехника":  {
		"!Бронемашины": 1,
		
	},
	"Воздушный флот":       {
		"!Боевой аэроплан": 0,
		"!Бомбардировщик":  0,
		"/Стратегические бомбардировщики": 0,
		
	},
	"Стратегия бронемашин": {
		">Бронемашины":          1,
		"*Бронемашины":          1,
		"!Аэроплан-истребитель": 1,
		"/Полугусеничные бронемашины": 0,
	},
	"Штурмовая техника":    {
		"!Танки":                 1,
		">Бронемашины":           1,
		">Бомбардировщик":        1,
		"/Штурмовые бронемашины": 0,
		"/Штурмовые танки":       0,
	},
	"Мобильная техника":    {
		">Бронемашины": 1,
		"*Бронемашины": 1,
		">Танки":       1,
		"*Танки":       1,
		">Аэроплан-истребитель": 1,
		"*Аэроплан-истребитель": 1,
		"/Танкетки":             0,
	},
}


const heavy_weapon: Dictionary = {
	"Тяжелая артиллерия": {
		">Артиллерия":           1,
		"$Потребление_снарядов": 1,
		"/Ранняя самоходная артиллерия": 1,
	},
	"Зенитные пулеметы":  {
		">Артиллерия":           1,
		"$Потребление_снарядов": 1,
	},
	"Рельсовые пушки":    {
		">Артиллерия":           1,
		"$Потребление_снарядов": 1,
		"/Увеличенный состав батарей":   1,
	},
	"Зенитная артиллерия":{
		">Артиллерия":           1,
		"$Потребление_снарядов": 1
	},
	"Средняя артиллерия": {
		">Артиллерия":           1,
		"$Потребление_снарядов": 1,
		"/Cамоходная артиллерия": 1,
	},
}


const light_weapon: Dictionary = {
	"Остроконечный патрон": {
		">Фронтовики":    1,
		">Кавалерия": 1,
		"/Автопистолеты":  0,
	},
	"Легкие пулеметы": {
		"*Фронтовики":    1,
		"*Кавалерия": 1,
		"/Бомбометы": 0,
	},
	"Окопные минометы": {
		"*Фронтовики":    2,
		"*Кавалерия": 2,
		"*Артиллерия":2,
		"/Каски для пехоты": 0,
	},
	"Штурмовое вооружение": {
		">Фронтовики":    1,
		">Кавалерия": 1,
		"/Ленточные пулеметы": 0,
	},
	"Современное вооружение": {
		">Фронтовики":    1,
		">Кавалерия": 1,
		">Гренадеры": 1,
		"/Автоматические винтовки": 1
	},
}


const factory_production: Dictionary = {	
	"Поточное производство": {
		"-Электрозапчасти": 10,
		"-Автомобили":      10,
		"-Телефоны":        10,
		"-Радио":           10,
		"-Снаряды":         5,
		"-Боеприпасы":      5,
	},
	
	"Искусственная резина":  {
		"-Резина":          15,
		"-Нефть":           10,
		"-Сталь":           10,
		"-Стекло":          10,
		"NРезина":          0,
	},
	
	"Сборочные конвейеры":   {
		"-Консервы":        10,
		"-Автомобили":      10,
		"-Телефоны":        10,
		"-Радио":           10,
	},
	
	"Военная промышленность":     {  #Сжижение угля
		"-Снаряды":            5,
		"-Боеприпасы":         5,
		"-Пулеметы":           5,
		"-Артиллерия":         5,
		"-Аэроплан":           5,
		"-Магазинные_винтовки":5,
		"NНефть":              0,
	},
	
	"Полимеры":              {
		"-Одежда":             15,
		"-Мебель":             15,
		"-Ткань":              15,
		"-Резина":             10,
	},
}


const farm_production: Dictionary = {
	"Применение удобрений": {
		"-Зерно": 5,
		"-Хлопок":5,
		"-Чай":   5,
	},
	"Углеродные удобрения": {
		"-Зерно": 5,
		"-Хлопок":5,
		"-Чай":   5,
	},
	"Фермерские тракторы":   {
		"-Зерно": 10,
		"-Чай":   10,
		"-Резина":10,
	},
	"Введение тракторов":    {
		"-Зерно": 10,
		"-Чай":   10,
		"-Резина":10,
	},
	"Частичная механизация": {
		"-Зерно": 10,
		"-Чай":   10,
		"-Скот":  10,
		"-Хлопок": 10,
	},
}


const resourses_production: Dictionary = {
	"Нефтяные хранилища": {
		"-Железо":    10,
		"-Уголь":     10,
		"-Селитра":   10,
		"-Нефть":     10,
	},
	
	"Частичная механизация": {
		"-Железо":  10,
		"-Уголь":   10,
		"-Селитра": 10,
		"-Нефть":   10,
		},
		
	"Новый метод добычи руды": {
		"-Железо":  10,
		"-Уголь":   10,
		"-Селитра": 10,
		},
	
	"Переработка нефти":     {
		"-Железо":  10,
		"-Уголь":   10,
		"-Резина":  10,
		"-Нефть":   10,
		},
		
	"Механизация шахт":      {
		"-Железо":  10,
		"-Уголь":   10,
		"-Селитра": 10,
		},
}


const railways: Dictionary = {
	"Рельсы узкой колеи":      {
		"+Инфраструктура":  1,
		"+Железная дорога": 1,
		"-Уголь":           5,
		"-Железо":          5,
	},
	"Прифронтовые склады":     {
		"+Железная дорога": 1,
		"$Снабжение":       1,
	},
	"Рельсы для фабрик":       {
		"+Инфраструктура":  1,
		"+Железная дорога": 1,
		"-Сталь":           5,
		"-Стекло":          5,
		"-Удобрения":       5,
	},
	"Выброска припасов":     {
		"$Снабжение":       1,
	},
	"Автобаны":                {
		"+Инфраструктура":  1,
		"+Железная дорога": 1,
		"-Сталь":           5,
		"-Стекло":          5,
	},
}

const list_of_new_factories: Dictionary = {
	 "Завод_резины":  {
		"Кроны":           150,
		"Сталь":           2,
	},
	"Нефтяной_завод":  {
		"Кроны":           150,
		"Сталь":           2,
	}
}


func research_completed(dict, player):
	
	var results_of_technology: Dictionary = get(research[dict.tipe_of_technology])[dict.technology]
	
	_research_completed(dict.technology, dict, player)
	
	player.levels_of_technologies[dict.tipe_of_technology] += 1
	
	if player.get_groups().has("Human") == true:
		player.window_research_end.update_information(results_of_technology, dict.technology)
		player.window_research.update_information()


func _research_completed(technology, dict, player):
	var list = get(research[dict.tipe_of_technology])[technology]
	for i in list:
		#var unit = i.erase(i[0], "!", ">", "*")
		var number = list[i]
		var action = check_action_with_unit(i)
		i.erase(0, 1)
		match action:
			"Новый тип войск":
				player.units_for_training.append(i)
			
			"Улучшение атаки":
				player.bonuses_of_units["Атака"][i] += number
			
			"Улучшение обороны":
				player.bonuses_of_units["Оборона"][i] += number
			
			"Потребление":
				player.bonuses_of_units[i] += number
				
			"Изобретение":
				pass
			"Выпуск продукции":
				player.production[i] += number * 0.01
				
			"Инфраструктура":
				pass
			
			"Новый вид завода":
				var factory = Players.goods_to_factory[i]
				player.buildings[factory] = list_of_new_factories[factory]
			


func check_action_with_unit(i):
	
	match i[0]:
		"-":
			return "Выпуск продукции"
		
		"+":
			return "Инфраструктура"
		
		"!":
			return "Новый тип войск"
		
		">":
			return "Улучшение атаки"
		
		"*":
			return "Улучшение обороны"
		
		"$":
			return "Потребление"
		
		"/":
			return "Изобретение"
		
		"N":
			return "Новый вид завода"
	
	return "Ничего не найдено!"


func return_results_of_research(dict):
	var massage = ""
	for i in dict:
		var num = str(dict[i])
		var I = i[0]
		i.erase(0, 1)
		match I:
			"-":
				massage = massage + "Выпуск продукции " + i + ": +" + num + "%" 
			
			"+":
				massage = massage + "Максимальный уровень " + i + ": +1"
			
			"!":
				massage = massage + "Новый тип войск: " + i
			
			">":
				massage = massage + "Улучшение атаки " + i + ": +" + num
			
			"*":
				massage = massage + "Улучшение обороны " + i + ": +" + num
			
			"$":
				massage = massage + i + ": +" + num
			
			"/":
				massage = massage + "Новое изобретение: " + i
			
			"N":
				massage = massage + "Новый вид завода: " + Players.goods_to_factory[i]
		massage = massage + "\n"
	
	return massage
